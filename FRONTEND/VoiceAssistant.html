<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HOW MAY I HELP YOU?</title>
    <link rel="stylesheet" href="output.css">
</head>

<body class="bg-[#0073E6] overflow-hidden">
    <div class="p-4">
        <div class="bg-black text-[#D9D9D9] flex items-center gap-2 w-fit px-4 py-2 rounded-[20px]">
            <img src="./assets/backArrow.svg" alt="backArrow" class="h-6 w-6 sm:h-8 sm:w-8">
            <h4 class="font-sans text-base sm:text-lg">BACK</h4>
        </div>
    </div>

    <div class="flex justify-center items-center min-h-[calc(100vh-80px)] px-4 flex-col">
        <div class="relative w-[250px] h-[250px] sm:w-[400px] sm:h-[400px] lg:w-[550px] lg:h-[550px] mb-6"
            onclick="gettingVoice()">
            <img src="./assets/assistantLogoBg.svg" alt="logobg" class="w-full h-full absolute top-0 left-0">

            <img src="./assets/assistantLogo.svg" alt=""
                class="absolute top-1/2 left-1/2 w-[180px] h-[180px] sm:w-[300px] sm:h-[300px] lg:w-[400px] lg:h-[400px] -translate-x-1/2 -translate-y-1/2">
        </div>

        <p class="font-sans font-bold text-[#D9D9D9]"><span id="userSaid">Tap To Speak</span></p>
    </div>
</body>

<script>
    const API_URL = 'https://ec-agentic-ai-backend-2onhyjxxx-saifmks-projects.vercel.app/api/runModel';
    let transcript = ""

    callApi();

    function gettingVoice() {
        console.log("OK HERE");

        const recognizer = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        recognizer.lang = 'en-US';

        // When mic starts
        document.getElementById("userSaid").textContent = "Listening...";

        // When result is received
        recognizer.onresult = (event) => {
            transcript = event.results[0][0].transcript;
            console.log("YOU SAID:", transcript);
            document.getElementById("userSaid").textContent = "YOU SAID :  " + transcript;

            callApi();
        };

        recognizer.start();
    }


    async function callApi() {
        try {
            const response = await fetch(API_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    text: transcript
                })
            });

            console.log("Status:", response.status);
            const text = await response.text(); // read raw text
            console.log("Raw response:", text);

            // Try parsing JSON only if status is 200
            if (response.ok) {
                const data = JSON.parse(text);
                console.log('API response:', data);
            }
        } catch (err) {
            console.error('Error calling API:', err);
        }
    }


</script>

</html>